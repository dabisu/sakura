.PHONY: all clean distclean install

override _CFLAGS=`pkg-config --cflags gtk+-2.0 vte`
override _LDFLAGS=`pkg-config --libs gtk+-2.0 vte`

ifdef ENABLE_DEBUG
override _CPPFLAGS=-UNDEBUG
override _CFLAGS+=-g -O0 -Wall
else
override _CPPFLAGS=-DNDEBUG
override _CFLAGS+=-O2
endif

SAKURA_SOURCES=$(wildcard src/*.c)
SAKURA_OBJECTS=$(patsubst %.c,%.o,$(wildcard src/*.c))
DEPENDENCIES=$(patsubst %.o,%.d,$(SAKURA_OBJECTS))
POFILES=$(wildcard po/*.po)

all: src/sakura localize

src/sakura: $(SAKURA_OBJECTS)
	$(MAKE.binary) $(SAKURA_OBJECTS)

clean:
	@rm -rf $(SAKURA_OBJECTS) $(DEPENDENCIES) src/sakura po/*.mo po/*.pot

distclean: clean
	@rm -rf Makefile config.mk config.h 

localize:
	@xgettext -o po/sakura.pot --keyword=_ $(SAKURA_SOURCES)
	@for i in $(POFILES); do \
		msgmerge -U $$i po/sakura.pot; \
		msgfmt -o $${i%*.po}.mo $$i; \
	done \

DIRMODE="a+rx,u+w"

install: all
	@cp -f $(CONFDIR)/pawm.conf $(CONFDIR)/pawm.conf~ ; true
	@$(call makedir,$(BINDIR),$(DIRMODE))
	@$(call install_files,src/sakura,$(BINDIR),a=rx)
# check why these don't work
#	@$(call makedir, "/usr/share/pixmaps", $(DIRMODE))
#	@$(call install_files, "./terminal-tango.png", /usr/share/pixmaps ,a=rx)
	@cp -f terminal-tango.png /usr/share/pixmaps ; true
	
